@using System.Globalization
@using GiveAidCharity.Models.Main
@model IEnumerable<GiveAidCharity.Models.Main.Donation>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";

    ViewBag.Title = "List";

    var totalPage = ((int?)ViewBag.TotalPage).Value;
    var currentPage = ((int?)ViewBag.CurrentPage).Value;
    var limit = ((int?)ViewBag.Limit).Value;
    var start = ViewBag.Start.ToString();
    var end = ViewBag.End.ToString();
    var currentPara = "?start=" + ViewBag.Start + "&end=" + ViewBag.End;

    var indexSo = (currentPage - 1) * limit + 1;
}
@section styles
{
    @Styles.Render("~/Content/DashboardTheme/css/paginate.css")
}
    <div class="row">
        <div class="col-md-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body table-responsive">
                    <h4 class="card-title">Date filer</h4>
                    <p class="card-description"> Basic form layout </p>
                    @using (Html.BeginForm("Index", "Donations", FormMethod.Get, new { id = "productForm" }))
                    {
                        <input type="hidden" id="startTime" name="start" value="@start" />
                        <input type="hidden" id="endTime" name="end" value="@end" />
                        <div class="form-row">
                            <div class="col-md-12 form-group">
                                <label for="datefilter">Date range picker</label>
                                <input type="text" id="datefilter" name="datefilter" value="" 
                                       class="form-control" style="margin-bottom: 50px;"/>
                            </div>

                        </div>
                        <div class="form-row">
                            <a href="@Url.Action("Index","Donations")" class="btn btn-light ml-auto">Clear Filter</a>
                            <button type="submit" class="btn btn-gradient-primary ml-2">Submit</button>
                        </div>
                    }

                </div>
            </div>
        </div>
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body table-responsive">
                    <h4 class="card-title">List Donation</h4>
                    <table class="table" id="update-student">
                        <thead class="text-primary">
                            <tr>
                                <th>
                                    #
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.ApplicationUser.UserName)
                                </th>
                                <th>
                                    Project
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Amount)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.PaymentMethod)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Status)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.CreatedAt)
                                </th>
                                <th class="text-center d-none d-lg-table-cell">
                                    Edit
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {

                                <tr>
                                    <td>
                                        <b class="text-small">@indexSo</b>
                                    </td>
                                    <td>
                                        <a href="#" class="badge w-100 badge-gradient-primary w-100">
                                            @item.ApplicationUser.UserName
                                        </a>
                                    </td>
                                    <td>
                                        <a href="#" class="badge w-100 badge-gradient-primary w-100">
                                            @item.Project.Name
                                        </a>
                                    </td>
                                    <td>
                                        <b class="text-small">@Html.DisplayFor(modelItem => item.Amount)</b>
                                    </td>
                                    <td class="d-none d-xl-table-cell ">
                                        <a class="badge text-white w-100
                                       @(item.PaymentMethod == Donation.PaymentMethodEnum.Paypal ? "badge-gradient-primary"
                                           : item.PaymentMethod == Donation.PaymentMethodEnum.VnPay ? "badge-gradient-warning"
                                               : "badge-secondary")">
                                            @Html.DisplayFor(modelItem => item.PaymentMethod)
                                        </a>
                                    </td>
                                    <td class="d-none d-xl-table-cell ">
                                        <a class="badge text-white w-100
                                       @(item.Status == Donation.DonationStatusEnum.Success ? "badge-gradient-primary"
                                           : item.Status == Donation.DonationStatusEnum.Pending ? "badge-gradient-warning"
                                               : "badge-secondary")">
                                            @Html.DisplayFor(modelItem => item.Status)
                                        </a>
                                    </td>
                                    <td>
                                        <b class="text-small">@Html.DisplayFor(modelItem => item.CreatedAt)</b>
                                    </td>
                                    <td class="text-center d-none d-lg-table-cell">
                                        <a class="badge badge-warning" href="#">
                                            <span class="mdi mdi-pencil-box-outline"></span>
                                        </a>
                                    </td>
                                </tr>
                                {
                                    indexSo++;
                                }
                            }
                        </tbody>
                    </table>

                </div>
                <div class="card-footer bg-white border-0">
                    @if (totalPage > 0)
                    {
                        <div>
                            <ul class="pagination text-center">
                                <li class="page-item ml-auto" style="opacity: 0"></li>

                                @if (currentPage > 3)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(1)&limit=@(limit)">
                                            <i class="mdi mdi-chevron-double-left"></i>
                                        </a>
                                    </li>
                                }

                                @if (currentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage - 1)&limit=@(limit)">
                                            <i class="mdi mdi-chevron-left"></i>
                                        </a>
                                    </li>
                                }

                                @if (currentPage > 2)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage - 2)&limit=@(limit)">
                                            @(currentPage - 2)
                                        </a>
                                    </li>
                                }

                                @if (currentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage - 1)&limit=@(limit)">
                                            @(currentPage - 1)
                                        </a>
                                    </li>
                                }

                                <li class="active page-item" aria-current="page">
                                    <a class="page-link" href="@currentPara&page=@(currentPage)&limit=@(limit)">
                                        @currentPage
                                    </a>
                                </li>

                                @if (totalPage - currentPage > 0)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage + 1)&limit=@(limit)">
                                            @(currentPage + 1)
                                        </a>
                                    </li>
                                }

                                @if (totalPage - currentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage + 2)&limit=@(limit)">
                                            @(currentPage + 2)
                                        </a>
                                    </li>
                                }

                                @if (currentPage < totalPage)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(currentPage + 1)&limit=@(limit)">
                                            <i class="mdi mdi-chevron-right"></i>
                                        </a>
                                    </li>
                                }

                                @if (currentPage < totalPage - 2)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@currentPara&page=@(totalPage)&limit=@(limit)">
                                            <i class="mdi mdi-chevron-double-right"></i>
                                        </a>
                                    </li>
                                }

                                <li class="page-item mr-auto" style="opacity: 0"></li>
                            </ul>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
@section scripts
{
    <script type="text/javascript">
        $(function () {
            // init start time and end time;
            var startDate = new Date();
            startDate.setFullYear(startDate.getFullYear() - 1);
            var endDate = new Date();

            // check start and end parameter
            const startPara = $("#startTime").val();
            if (startPara != null && startPara !== "") {
                startDate = new Date(startPara);
            }

            const endPara = $("#endTime").val();
            if (endPara != null && endPara !== "") {
                endDate = new Date(endPara);
            }

            $('input[name="datefilter"]').daterangepicker({
                autoUpdateInput: true,
                startDate: startDate,
                endDate: endDate,
                locale: {
                    cancelLabel: 'Clear'
                }
            });

            $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
                const start = picker.startDate.format('YYYY-MM-DD');
                const end = picker.endDate.format('YYYY-MM-DD');
                $("#startTime").val(start);
                $("#endTime").val(end);
                    console.log(start + " " + end);
                    console.log(startPara + " " + endPara);
            });

        });
    </script>
}

